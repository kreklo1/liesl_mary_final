---
title: "help Final"
output:
  flexdashboard::flex_dashboard:
    theme:
      bg: "#fcf7e9"
      fg: "#d41495" 
      primary: "#d41495"
runtime: shiny
---


```{r libraries and data, include = FALSE}
library(ggplot2)
library(dplyr)
library(tidyr)
library(lubridate)
library(stringr)
library(emojifont)
library(ggtext)
library(leaflet)
library(sf)
library(tidyverse)
library(shiny)
library(readr)
library(jsonlite)
library(wordcloud)
library(tidytext)
library(wordcloud2)
library(AER)
library(kableExtra)
library(beepr)
library(shinyWidgets)
```

```{r data entry, include=FALSE}
airbnb_data <- read_csv("airbnb_data.csv")

rats <- read_csv("Rat_Sightings_20240507.csv")|>
  filter(Latitude!="NA",
         Longitude!="NA")

parks <- read_csv("Parks_Properties_20240507.csv")
parks_sf <- st_as_sf(parks, wkt = "multipolygon")


url<- "https://data.cityofnewyork.us/resource/fi97-k4k6.json"

farmers_markets <- fromJSON(url)|>
  mutate(latitude=as.numeric(latitude),
         longitude=as.numeric(longitude))



manhattan_lat_range <- c(40.70, 40.88)
manhattan_lon_range <- c(-74.02, -73.93)

brooklyn_lat_range <- c(40.57, 40.74)
brooklyn_lon_range <- c(-74.04, -73.82)

queens_lat_range <- c(40.53, 40.79)
queens_lon_range <- c(-73.96, -73.71)

bronx_lat_range <- c(40.79, 40.92)
bronx_lon_range <- c(-73.93, -73.73)

staten_island_lat_range <- c(40.48, 40.65)
staten_island_lon_range <- c(-74.27, -74.04)

airbnb_data <- read_csv("airbnb_data.csv")


airbnb_with_boroughs<-airbnb_data|>
  mutate(borough = ifelse(airbnb_data$Latitude >= manhattan_lat_range[1] & airbnb_data$Latitude <= manhattan_lat_range[2] &
                                airbnb_data$Longitude >= manhattan_lon_range[1] & airbnb_data$Longitude <= manhattan_lon_range[2],
                              "Manhattan",
                              ifelse(airbnb_data$Latitude >= brooklyn_lat_range[1] & airbnb_data$Latitude <= brooklyn_lat_range[2] &
                                       airbnb_data$Longitude >= brooklyn_lon_range[1] & airbnb_data$Longitude <= brooklyn_lon_range[2],
                                     "Brooklyn",
                                     ifelse(airbnb_data$Latitude >= queens_lat_range[1] & airbnb_data$Latitude <= queens_lat_range[2] &
                                              airbnb_data$Longitude >= queens_lon_range[1] & airbnb_data$Longitude <= queens_lon_range[2],
                                            "Queens",
                                            ifelse(airbnb_data$Latitude >= bronx_lat_range[1] & airbnb_data$Latitude <= bronx_lat_range[2] &
                                                     airbnb_data$Longitude >= bronx_lon_range[1] & airbnb_data$Longitude <= bronx_lon_range[2],
                                                   "Bronx",
                                                   ifelse(airbnb_data$Latitude >= staten_island_lat_range[1] & airbnb_data$Latitude <= staten_island_lat_range[2] &
                                                            airbnb_data$Longitude >= staten_island_lon_range[1] & airbnb_data$Longitude <= staten_island_lon_range[2],
                                                      "Staten Island", "No Borough"))))))


rats <- read_csv("Rat_Sightings_20240507.csv")|>
  filter(Latitude!="NA",
         Longitude!="NA")

parks <- read_csv("Parks_Properties_20240507.csv")
parks_sf <- st_as_sf(parks, wkt = "multipolygon")


url<- "https://data.cityofnewyork.us/resource/fi97-k4k6.json"

farmers_markets <- fromJSON(url)|>
  mutate(latitude=as.numeric(latitude),
         longitude=as.numeric(longitude))

rats_graph<-rats|>
  sample_n(225)  |>
  select(Latitude, Longitude) 


airbnb_parsed <- airbnb_data |>
  select(Name, Title, Id, `Listing URL`, Price, Beds, Baths, Bedrooms, `Average Rating`, `Number of Reviews`, `More Details`, `Listing Type`, `Room Type Category`) |>
  mutate(price_parsed = parse_number(Price))

airbnb_nona <- na.omit(airbnb_parsed)

```


PAGE 1
=======
```{r}
selectInput("x", label = "x-axis variable:",
  choices = c("# of Reviews" = "Number of Reviews",
              "# of Beds" = "Beds",
              "# of Baths" = "Baths",
              "Price" = "price_parsed",
              "⭐ Review" = "Average Rating"))
              
selectInput("y", label = "y-axis variable:",
  choices = c("⭐ Review" = "Average Rating",
              "Price" = "price_parsed",
              "# of Baths" = "Baths",
              "# of Beds" = "Beds",
              "# of Reviews" = "Number of Reviews"))

renderPlot({
  
  ggplot(airbnb_nona, aes(x = .data[[input$x]], y = .data[[input$y]])) +
    geom_point(size = 2, alpha = 0.25, color = "hotpink") +
    geom_smooth(se = FALSE) +
    labs(x = input$x, y = input$y, title = paste(input$x, "vs", input$y))
})

```


PAGE 2 
===============================

```{r}
bar_data <- airbnb_nona |>
  group_by(`Room Type Category`)

```


PAGE 3
===============================


Our Favorites
==========================

Column {data-width=3}
-------------------------

**Mary's Favorite**

I chose a condo in Manhattan with the Name "Cozy & Chic, Chelsea High Line Studio" as my favorite AirBnb in New York City. As you can see from the table below, this AirBnb is a Guest Favorite, and is very highly rated. Check out [this link](https://www.airbnb.com/rooms/808386228706904148?source_impression_id=p3_1715360488_%2FcmH40MOuzoem%2Bl9) to learn more about it!


```{r, echo=FALSE}
mary_airbnb<-airbnb_with_boroughs|>
  filter(Name=="New! Cozy & Chic, Chelsea High Line Studio")|>
  select("Name", "Title", "Price", "Baths", "Bedrooms", "Average Rating", "Number of Reviews", "Room Type Category", "More Details", "borough")

kable(mary_airbnb, format = "html")|>
  kable_styling()
```




Next time you are looking for a place to stay in New York City, consider splurging a bit on this beautiful AirBnb! Sadly, none of the rats in our sampling of rat sightings were spotted around here, so no bro-dents, however, there are 3 farmer's markets and several parks nearby so lots to do and explore!

Column {data-width=6}
-------------------------

```{r, echo=FALSE}
rat_icon <- makeIcon(
  iconUrl = "https://icons.iconarchive.com/icons/google/noto-emoji-animals-nature/256/22251-rat-icon.png",
  iconWidth = 28,
  iconHeight = 28
)

carrot_icon <- makeIcon(
  iconUrl = "https://images.emojiterra.com/google/noto-emoji/unicode-15.1/color/svg/1f955.svg",
  iconWidth = 29,
  iconHeight = 29
)

star_icon<-makeIcon(iconUrl="https://www.clipartmax.com/png/full/85-851033_filesolid-bright-green-star-1-green-star-no-background.png", iconWidth=48, iconHeight=48)

renderLeaflet({
leaflet(width = "100%", height = 600) |>
  addTiles() |>
  setView(lng = -74.00, lat = 40.74, zoom = 12)|>
  addMarkers(data=farmers_markets, lng=~longitude, lat=~latitude, icon = carrot_icon, popup = ~paste(marketname, "</br>", daysoperation, hoursoperations))|>
  addMarkers(data=rats_graph, lng=~Longitude, lat=~Latitude, icon = rat_icon, popup = ~paste("squeak squeak:)"))|>
  addPolygons(data=parks_sf, color="deeppink", popup = ~paste(SIGNNAME))|>
  addMarkers(lng = -74.00579, lat = 40.74473, popup = "Mary's Favorite!", 
               icon = star_icon)|>
  addMarkers(lng = -73.99961, lat = 40.71701, popup = "Liesl's Favorite!", 
               icon = star_icon)
})
beep(sound = 11)
```

Column {data-width=3}
-------------------------

**Liesl's Favorite**

My favorite Airbnb in New York city is [this one](https://www.airbnb.com/rooms/41178612?source_impression_id=p3_1715728914_jTNcY96IHSz6LdHw). It has a nice location in SoHo with a terrace, lots of natural lighting, and fun furniture. In the table below you can see the important information for this stay!

```{r, echo = FALSE}
liesls_fav <- airbnb_with_boroughs |>
  filter(`Room Type Category` == "entire_home",
         Name == "Space Age SoHo Penthouse: Private Terrace & Roof") |>
  select("Name", 
         "Title", 
         "Price", 
         "Baths", 
         "Bedrooms", 
         "Average Rating", 
         "Number of Reviews", 
         "Room Type Category", 
         "More Details", 
         "borough")
kable(liesls_fav, format = "html")|>
  kable_styling()
```

On the map below you can see where this Airbnb is and its relationship to all of the other rentals, the rat sightings, the parks, and the farmer's markets. The location is conveniently placed in SoHo with lots of shops and restaurants nearby. 



